<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>St. Mary’s University Payment</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body, html { height: 100%; font-family: 'Poppins', sans-serif; color: #fff; background: #071026; }
    /* Animated gradient background */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background: linear-gradient(120deg, #071026 0%, #0f2138 25%, #0b2b3a 50%, #072a3a 75%, #071026 100%);
      z-index: -3;
    }
    /* moving subtle color layer */
    body::after {
      content: '';
      position: fixed; inset: 0;
      background: linear-gradient(60deg, rgba(0,200,255,0.06), rgba(255,0,150,0.04), rgba(0,255,150,0.03));
      background-size: 400% 400%;
      animation: floaty 18s linear infinite;
      z-index: -2;
      mix-blend-mode: overlay;
    }
    @keyframes floaty {
      0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}
    }

    .container { display:flex; min-height:100vh; }
    /* Sidebar */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6));
      padding: 28px 18px;
      box-shadow: 4px 0 30px rgba(0,0,0,0.6);
      display:flex; flex-direction:column; gap:14px;
      align-items:stretch;
      z-index: 1;
    }
    .brand {
      text-align:center;
      color:#00f7ff;
      font-weight:700;
      font-size:20px;
      text-shadow:0 0 8px rgba(0,255,255,0.12);
      margin-bottom:6px;
    }
    .sidebar .top-actions { display:flex; flex-direction:column; gap:10px; }
    .sidebar button {
      padding:11px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:600;
      transition: transform .14s ease, box-shadow .14s;
      background: rgba(255,255,255,0.06);
      color: #fff;
      backdrop-filter: blur(4px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    .sidebar button:hover { transform: translateY(-3px); box-shadow: 0 10px 28px rgba(0,0,0,0.55); }

    /* Group for the extra action buttons (placed below Transaction History) */
    .action-group { margin-top: 8px; display:flex; flex-direction:column; gap:8px; }

    /* main area */
    .main { flex:1; display:flex; align-items:center; justify-content:center; padding:36px; }
    .card {
      width:100%; max-width:520px;
      background: rgba(255,255,255,0.06);
      border-radius:16px;
      padding:28px;
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 50px rgba(3,10,20,0.6);
      color: #eaf6ff;
      border: 1px solid rgba(255,255,255,0.06);
    }
    .card h1 { text-align:center; color:#66f0ff; margin-bottom:16px; text-shadow:0 0 16px rgba(102,240,255,0.08); font-size:22px; }
    label { display:block; font-size:14px; margin-top:8px; color:rgba(230,245,255,0.9); }
    .input {
      width:100%; padding:12px 14px; margin-top:8px;
      border-radius:10px; border:1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.03); color:#eaf6ff; font-size:15px;
      outline:none; transition: box-shadow .15s, border-color .15s;
    }
    .input::placeholder { color: rgba(230,245,255,0.5); }
    .input:focus { box-shadow: 0 6px 22px rgba(102,240,255,0.08); border-color: rgba(102,240,255,0.5); }

    .row { display:flex; gap:10px; }
    .btn {
      display:inline-block; width:100%; padding:12px; margin-top:14px; border-radius:10px;
      border:none; cursor:pointer; font-weight:700; font-size:15px;
      background: linear-gradient(90deg,#00f7ff,#0088ff); color:#00121b; box-shadow:0 8px 30px rgba(0,136,255,0.16);
      transition: transform .12s, box-shadow .12s;
    }
    .btn:hover { transform:translateY(-3px); box-shadow:0 12px 36px rgba(0,136,255,0.22); }

    .secondary {
      background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      color: #eefaff; border:1px solid rgba(255,255,255,0.06);
      box-shadow: none; font-weight:600;
    }

    .hidden { display:none; }

    /* Payment method radio group style */
    .method-group { margin-top:12px; display:flex; flex-direction:column; gap:10px; }
    .method-row { display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; background: rgba(0,0,0,0.12); border:1px solid rgba(255,255,255,0.03); }
    .method-row input[type="radio"] { width:16px; height:16px; accent-color:#00f7ff; }
    .note {
      background: rgba(0,0,0,0.18); padding:12px; border-radius:10px; margin-top:12px; color:#dff8ff; border:1px solid rgba(102,240,255,0.06);
    }

    .receipt {
      background: rgba(0,0,0,0.22); border-radius:10px; padding:14px; margin-top:14px; color:#dff8ff;
      border:1px solid rgba(255,255,255,0.04);
    }

    input[type="file"] { color: #fff; margin-top:6px; }

    hr { border: none; border-top:1px solid rgba(255,255,255,0.04); margin:12px 0; }

    @media (max-width:780px) {
      .container { flex-direction:column; }
      .sidebar { width:100%; flex-direction:row; gap:10px; padding:12px; align-items:center; justify-content:center; }
      .brand { display:none; }
      .main { padding:16px; }
      .card { padding:20px; max-width:100%; border-radius:12px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="brand">St. Mary’s Pay</div>

      <!-- Top actions: New Payment + Transaction History -->
      <div class="top-actions">
        <button onclick="showForm()">New Payment</button>
        <button onclick="showHistory()">Transaction History</button>
      </div>

      <!-- Separator then the extra action buttons (they are below Transaction History) -->
      <div class="action-group" aria-hidden="false">
        <button class="secondary" onclick="payUsingEnteredPhone()">Pay using entered phone</button>
        <button class="secondary" onclick="payUsingStMary()">Pay using St. Mary's Telebirr</button>
        <button class="secondary" onclick="openQRConfirm()">Confirm with QR / Screenshot</button>
      </div>
    </aside>

    <main class="main">
      <!-- FORM CARD -->
      <section class="card" id="form-card">
        <h1>St. Mary’s University Payment</h1>

        <label for="studentName">Full Name</label>
        <input id="studentName" class="input" type="text" placeholder="John Kebede">

        <label for="deptIdYear">Department / ID / Year</label>
        <input id="deptIdYear" class="input" type="text" placeholder="Ex: RCD/0000/2016">

        <button class="btn" onclick="goToPayment()">Continue</button>
      </section>

      <!-- PAYMENT CARD -->
      <section class="card hidden" id="payment-card">
        <h1>Confirm & Pay</h1>

        <p style="color:#dff8ff;"><strong>Student name:</strong> <span id="confName"></span></p>
        <p style="color:#dff8ff;"><strong>Dept / ID / Year:</strong> <span id="confDept"></span></p>

        <hr>

        <label for="payPhone">Telebirr Phone Number (you will pay with)</label>
        <input id="payPhone" class="input" type="tel" placeholder="09XXXXXXXX">

        <label for="payerFullName">Name on payment</label>
        <input id="payerFullName" class="input" type="text" placeholder="John Kebede">

        <label for="amount">Amount (ETB)</label>
        <input id="amount" class="input" type="number" placeholder="e.g. 2000">

        <!-- Payment method options -->
        <div class="method-group" aria-label="payment methods">
          <div class="method-row">
            <input type="radio" id="m_phone" name="method" value="phone" checked>
            <label for="m_phone">Send request to the phone number I entered above</label>
          </div>

          <div class="method-row">
            <input type="radio" id="m_stmary" name="method" value="stmary">
            <label for="m_stmary">Send request to St. Mary's Telebirr (St. Mary's number: <strong id="stmary-num">0912345678</strong>)</label>
          </div>

          <div class="method-row">
            <input type="radio" id="m_qr" name="method" value="qr">
            <label for="m_qr">I will confirm using QR / Screenshot (upload proof)</label>
          </div>
        </div>

        <!-- Instruction / status area -->
        <div id="payment-note" class="note hidden"></div>

        <!-- Upload area appears only when QR method chosen -->
        <div id="qr-upload" class="hidden" style="margin-top:10px;">
          <label style="font-size:13px; color:#dff8ff;">Upload screenshot of payment or QR scan</label>
          <input id="screenshotFile" type="file" accept="image/*">
          <div style="font-size:13px; color:#d0f7ff; margin-top:8px;">After uploading, press <strong>Confirm payment (QR)</strong>.</div>
        </div>

        <div class="row">
          <button class="btn" onclick="makePayment()">Pay / Send Request</button>
        </div>
      </section>

      <!-- QR Confirmation Modal-like card -->
      <section class="card hidden" id="qr-confirm-card">
        <h1>Confirm with QR / Screenshot</h1>
        <p class="note">If you uploaded a screenshot of the payment or scanned a QR, press Confirm below. This demo only records the file locally in the page (no server).</p>

        <div id="uploaded-preview" class="receipt hidden"></div>

        <div class="row">
          <button class="btn" onclick="confirmQRPayment()">Confirm payment (QR)</button>
          <button class="btn secondary" style="margin-left:8px;" onclick="cancelQR()">Cancel</button>
        </div>
      </section>

      <!-- RECEIPT CARD -->
      <section class="card hidden" id="receipt-card">
        <h1>Payment Receipt</h1>
        <div class="receipt">
          <p><strong>Payer:</strong> <span id="rcpPayer"></span></p>
          <p><strong>Paid to:</strong> <span id="rcpPaidTo">St. Mary’s University</span></p>
          <p><strong>Amount:</strong> <span id="rcpAmount"></span> ETB</p>
          <p><strong>Dept / ID / Year:</strong> <span id="rcpDept"></span></p>
          <p><strong>Reference No:</strong> <span id="rcpRef"></span></p>
          <p id="rcpMethod" style="margin-top:6px;"></p>
        </div>
        <button class="btn" onclick="resetAll()">Make Another Payment</button>
      </section>

      <!-- HISTORY CARD -->
      <section class="card hidden" id="history-card">
        <h1>Transaction History</h1>
        <p class="note">(Demo only — no real history)</p>
        <div id="history-list" style="margin-top:12px; max-height:240px; overflow:auto;"></div>
        <button class="btn secondary" style="margin-top:10px;" onclick="showForm()">Back to Payment</button>
      </section>
    </main>
  </div>

  <script>
    // Basic UI helpers
    function hideAll() {
      ['form-card','payment-card','receipt-card','history-card','qr-confirm-card'].forEach(id=>{
        document.getElementById(id).classList.add('hidden');
      });
      // reset note area
      document.getElementById('payment-note').classList.add('hidden');
      document.getElementById('qr-upload').classList.add('hidden');
    }
    function showForm(){ hideAll(); document.getElementById('form-card').classList.remove('hidden'); }
    function showHistory(){ hideAll(); document.getElementById('history-card').classList.remove('hidden'); }
    // On load
    showForm();

    // Continue from form to payment
    function goToPayment(){
      const name = document.getElementById('studentName').value.trim();
      const didy = document.getElementById('deptIdYear').value.trim();
      if(!name || !didy){ alert('Please fill both fields.'); return; }
      document.getElementById('confName').innerText = name;
      document.getElementById('confDept').innerText = didy;
      hideAll();
      document.getElementById('payment-card').classList.remove('hidden');
    }

    // Main makePayment — handles the selected method
    function makePayment(){
      const payPhone = document.getElementById('payPhone').value.trim();
      const payerName = document.getElementById('payerFullName').value.trim();
      const amount = document.getElementById('amount').value;
      const method = document.querySelector('input[name="method"]:checked').value;

      if(method === 'qr'){
        // switch to QR confirm card for file upload & confirmation
        hideAll();
        document.getElementById('qr-confirm-card').classList.remove('hidden');
        // show uploaded preview if exists
        previewUploadedFile();
        return;
      }

      // For phone-based methods, require phone and payer name & amount
      if(!payPhone || !payerName || !amount || Number(amount) <= 0){
        alert('Please complete payment details (phone, name, amount).'); return;
      }

      // Simulate sending request depending on method
      let targetPhone = '';
      if(method === 'phone'){
        targetPhone = payPhone;
      } else if(method === 'stmary'){
        // use the fake St Mary's number from UI
        targetPhone = document.getElementById('stmary-num').innerText || '0912345678';
      }

      // Show a clear instructional message to user
      const note = document.getElementById('payment-note');
      note.classList.remove('hidden');
      note.innerHTML = `<strong>Request sent to ${escapeHtml(targetPhone)}.</strong><br>
        We sent a Telebirr request to <strong>${escapeHtml(targetPhone)}</strong>. Please enter your Telebirr PIN on that phone to approve and deposit the amount of <strong>${escapeHtml(amount)} ETB</strong>. Once the payment is completed on the phone, click <em>Confirm</em> below.`;

      // Provide confirm button inline
      if(!document.getElementById('payment-note-confirm')){
        const btn = document.createElement('button');
        btn.id = 'payment-note-confirm';
        btn.textContent = 'I entered PIN — Confirm payment';
        btn.className = 'btn';
        btn.style.marginTop = '12px';
        btn.onclick = function(){ finalizePayment(targetPhone, payerName, amount, 'Telebirr request to ' + targetPhone); };
        note.appendChild(btn);
      }

      // Keep the payment card visible so user can confirm
      document.getElementById('payment-card').classList.remove('hidden');
    }

    // Finalize payment (create receipt, add to history)
    function finalizePayment(targetPhone, payerName, amount, methodLabel){
      // populate receipt
      const dept = document.getElementById('confDept').innerText;
      const ref = 'REF' + Date.now();
      document.getElementById('rcpPayer').innerText = payerName;
      document.getElementById('rcpAmount').innerText = amount;
      document.getElementById('rcpDept').innerText = dept;
      document.getElementById('rcpRef').innerText = ref;
      document.getElementById('rcpMethod').innerText = `Method: ${methodLabel}`;

      // Add to history (demo)
      addToHistory({payer: payerName, amount, dept, ref, method: methodLabel, time: new Date().toLocaleString()});

      hideAll();
      document.getElementById('receipt-card').classList.remove('hidden');
    }

    // Shortcut functions invoked by sidebar action buttons
    function payUsingEnteredPhone(){
      // show payment card and pre-select method
      hideAll();
      document.getElementById('payment-card').classList.remove('hidden');
      document.getElementById('m_phone').checked = true;
    }
    function payUsingStMary(){
      hideAll();
      document.getElementById('payment-card').classList.remove('hidden');
      document.getElementById('m_stmary').checked = true;
      // prefill payPhone with St Mary's number to make it clearer
      document.getElementById('payPhone').value = document.getElementById('stmary-num').innerText;
      document.getElementById('payerFullName').value = 'St. Mary’s University';
    }
    function openQRConfirm(){
      hideAll();
      document.getElementById('payment-card').classList.remove('hidden');
      document.getElementById('m_qr').checked = true;
      document.getElementById('qr-upload').classList.remove('hidden');
      // show instructions in the note area
      const note = document.getElementById('payment-note');
      note.classList.remove('hidden');
      note.innerHTML = `<strong>QR / Screenshot confirmation</strong><br>
        Choose "I will confirm using QR / Screenshot", upload proof using the uploader, then click the "Confirm payment (QR)" button to finish.`;
    }

    // QR confirm flow
    function previewUploadedFile(){
      const fileInput = document.getElementById('screenshotFile');
      const preview = document.getElementById('uploaded-preview');
      preview.classList.add('hidden');
      preview.innerHTML = '';
      if(fileInput && fileInput.files && fileInput.files[0]){
        const f = fileInput.files[0];
        const reader = new FileReader();
        reader.onload = function(e){
          preview.classList.remove('hidden');
          const img = document.createElement('img');
          img.src = e.target.result;
          img.style.maxWidth = '100%';
          img.style.borderRadius = '8px';
          img.style.display = 'block';
          img.style.marginBottom = '8px';
          preview.appendChild(img);
          const caption = document.createElement('div');
          caption.style.fontSize = '13px';
          caption.style.color = '#dff8ff';
          caption.textContent = `File: ${f.name}`;
          preview.appendChild(caption);
        };
        reader.readAsDataURL(f);
      }
    }

    // called when user presses Confirm payment (QR)
    function confirmQRPayment(){
      // get some basic fields
      const payerName = document.getElementById('payerFullName').value.trim() || document.getElementById('studentName').value.trim() || 'Unknown';
      const amount = document.getElementById('amount').value;
      if(!amount || Number(amount)<=0){ alert('Please enter payment amount before confirming.'); return; }
      // pretend we validated the screenshot - create receipt
      const methodLabel = 'QR / screenshot confirmation (uploaded)';
      finalizePayment('uploaded-screenshot', payerName, amount, methodLabel);
    }
    function cancelQR(){ hideAll(); document.getElementById('payment-card').classList.remove('hidden'); }

    // when user clicks the confirm button inside the note (we created earlier)
    function finalizeFromNote(){
      // this function is no longer used, finalizePayment used directly
    }

    // small helper to add to demo history
    function addToHistory(entry){
      const list = document.getElementById('history-list');
      const el = document.createElement('div');
      el.style.padding = '10px'; el.style.borderBottom = '1px dashed rgba(255,255,255,0.03)';
      el.innerHTML = `<strong>${escapeHtml(entry.payer)}</strong> — ${escapeHtml(entry.amount)} ETB<br>
        <small style="color:#dff8ff">${escapeHtml(entry.method)} • ${escapeHtml(entry.time)} • ref: ${escapeHtml(entry.ref)}</small>`;
      list.prepend(el);
    }

    // helper used by note confirm button to finalize (keeps closure values)
    function finalizePayment(targetPhone, payerName, amount, methodLabel){
      // same body as above finalizePayment — to avoid code duplication we delegate:
      (function doFinalize(){
        const dept = document.getElementById('confDept').innerText;
        const ref = 'REF' + Date.now();
        document.getElementById('rcpPayer').innerText = payerName;
        document.getElementById('rcpAmount').innerText = amount;
        document.getElementById('rcpDept').innerText = dept;
        document.getElementById('rcpRef').innerText = ref;
        document.getElementById('rcpMethod').innerText = `Method: ${methodLabel}`;
        addToHistory({payer: payerName, amount, dept, ref, method: methodLabel, time: new Date().toLocaleString()});
        hideAll(); document.getElementById('receipt-card').classList.remove('hidden');
      })();
    }

    // Reset to initial
    function resetAll(){
      document.getElementById('studentName').value='';
      document.getElementById('deptIdYear').value='';
      document.getElementById('payPhone').value='';
      document.getElementById('payerFullName').value='';
      document.getElementById('amount').value='';
      // clear file input and preview
      const fi = document.getElementById('screenshotFile');
      if(fi) fi.value = '';
      document.getElementById('uploaded-preview').classList.add('hidden');
      hideAll(); document.getElementById('form-card').classList.remove('hidden');
    }

    // small utility to escape HTML for inserted text nodes
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); });
    }

    // watch for file selection to preview on QR confirm screen
    document.addEventListener('change', function(e){
      if(e.target && e.target.id === 'screenshotFile'){
        // move to QR confirm card immediately so user sees preview
        previewUploadedFile();
      }
    });

    // Prefill a fake St Mary's number (you can change it)
    document.getElementById('stmary-num').innerText = '0912345678';
  </script>
</body>
</html>

